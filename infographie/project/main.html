<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<!--<link rel="stylesheet" href="css/stylesheet.css">-->
		<script src="../js/commonFunctions.js"></script>
		<script src="../js/gl-matrix-min.js"></script>
		<script src="../js/webglTools.js"></script>
		<script src="../js/loadModel3D.js"></script>
		<script src="../js/OBJ_loader.js"></script>
		<script src="scene.js"></script>
		<script src="planet.js"></script>
		<script id="shader-vs" type="x-shader/x-vertex">
			const vec3 lightpos = vec3(0.0, 0.0, 0.0);
			attribute vec3 aVertexPosition;
			attribute vec2 aTextureCoord;
		    uniform mat4 uMVMatrix;
		    uniform mat4 uPMatrix;
			uniform vec3 center; // fixme
			uniform float radius;
			uniform int vmode; // fixme
			varying vec3 vLightpos;
			varying vec2 vTextureCoord;
		    void main(void) {
				gl_PointSize = 4.0;
				vTextureCoord = aTextureCoord;
				vec4 a = uPMatrix * vec4(aVertexPosition * radius, 1.0);
				vec4 c = uPMatrix * uMVMatrix * vec4(center, 1.0);
				vLightpos = (uPMatrix * uMVMatrix * vec4(lightpos, 1.0)).xyz;	
				gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition * radius + center, 1.0);
			}
		</script>
		<script id="shader-fs" type="x-shader/x-fragment">
			#ifdef GL_ES
				precision highp float;
			#endif
			const float alpha = 8.0;
			uniform int fmode; // fixme
			uniform sampler2D uColorTexture;
			uniform sampler2D uNormalTexture;
			uniform sampler2D uSpecularTexture;
			varying vec3 vLightpos;
			varying vec2 vTextureCoord;
			void main(void) {
				vec2 mapCoord = vec2(vTextureCoord.s, vTextureCoord.t);
				vec4 texelColor = texture2D(uColorTexture, mapCoord);
				vec4 texelNormal = texture2D(uNormalTexture, mapCoord);
				vec4 texelSpecular = texture2D(uSpecularTexture, mapCoord);
				
				vec3 finalColor;
				vec3 L = normalize(vLightpos);
				vec3 N = normalize(texelNormal.rgb);
				float lambertTerm = dot(N, -L);
				if(lambertTerm > -2.0)
				{
					/**/
					vec3 uMaterialDiffuse = vec3(0.5, 0.5, 0.5);
					vec3 uMaterialSpecular = vec3(0.5, 0.5, 0.5);
					vec3 vEyeVec = vec3(0.0, 0.0, 1.0);
					/**/
					
					vec3 finalColor = vec3(0.0,0.0,0.0);
					// finalColor += uMaterialDiffuse * lambertTerm;
					
					vec3 E = normalize(vEyeVec);
					vec3 R = reflect(L, N);
					float specular = pow(max(dot(R, E), 0.0), alpha);
					// finalColor += uMaterialSpecular * specular * texelSpecular.rgb;
					gl_FragColor = vec4(finalColor + texelColor.rgb, 1.0);
				}
				else
				{
					gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
				}
			}
		</script>
	</head>
	<body onload="initWebGL()">
		<button onclick="pauseBoolF()">Play/pause</button>
		<button onclick="orbitBoolF()">Show/hide orbits</button>
		<br/>
		<canvas id="webgl-canvas" width="750" height="750">
			HTML5 is not supported
		</canvas>
	</body>
	<script src='../js/mouseMotionHandling.js'></script>
</html>
